---
title: "IMDB Rating Prediction"
subtitle: "IS 407 Group 6"
author: "Ujjayini Bose | Kaivan Gandhi | Donlapun Wongkarnta | Alekhya Nathella "
institute: "University of Illinois at Urbana-Champaign"
date: "`r Sys.Date()`"
output: 
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

#Research Question
How will the IMDB Score of a movie change based on various variables?
#Initial Project Plan
- EDA of the dataset to analyze the data before coming to any assumptions
- Build visualizations to identify patterns, trends and outliers 
- Find a correlation between the IMDB score and other variables in the dataset to shortlist those with stronger correlations as numerical predictors for our movie rating.
- Build a linear regression model to analyze the relationship between the outcome and predictor variables.
- We plan to use another model (to be decided later) to compare the accuracy between the two models.

---
#Data
The dataset has been taken from Kaggle and consists of IMDB movie information. It is a well rounded dataset with both numerical and categorical variables. We are going to analyze each and every factors which can influence the IMDB ratings so that we can predict better results


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(broom)
library(ggplot2)
library(tm)
library(dplyr)
library(wordcloud)
library(plyr)
library(reshape2)
```


```{r, echo=FALSE}
data <- read.csv("../data/movie_metadata.csv")
glimpse(data)
```





```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```


---
# Exploratory Data Analysis

-Summary statistics

-Missing Columns

-Visualizations

---
# Data Cleaning


- Removal of spurious characters (Â) from a the movie title, genre and plot keyword columns.

- Remove the duplicates in the data, using then "movie_title" column.

- Converted the Budget and Gross columns to USD

- Calculated Profit variable


```{r, include=FALSE}
data$movie_title <- (sapply(data$movie_title,gsub,pattern="\\Â",replacement=""))
data$genres_2 <- (sapply(data$genres,gsub,pattern="\\|",replacement=" "))
data$plot_keywords_2 <- (sapply(data$plot_keywords,gsub,pattern="\\|",replacement=" "))

data = data[!duplicated(data$movie_title),]

data <- transform(data, budget = ifelse(country == "South Korea", budget/1335.19, budget))
data <- transform(data, budget = ifelse(country == "Japan", budget/139.11, budget))
data <- transform(data, budget = ifelse(country == "Turkey", budget/18.61, budget))
data <- transform(data, budget = ifelse(country == "Hungary", budget/392.69, budget))
data <- transform(data, budget = ifelse(country == "Thailand", budget/35.69, budget))


data <- transform(data, gross = ifelse(country == "South Korea", gross/1335.19, gross))
data <- transform(data, gross = ifelse(country == "Japan", gross/139.11, gross))
data <- transform(data, gross = ifelse(country == "Turkey", gross/18.61, gross))
data <- transform(data, gross = ifelse(country == "Hungary", gross/392.69, gross))
data <- transform(data, gross = ifelse(country == "Thailand", gross/35.69, gross))


data$profit_flag <- as.factor(ifelse((data$gross > data$budget),1,0))

```

---
Genre variable contains more than one genre. The column was cleaned and separated
  1. Cleaning of the Genre Variable
  2. Converting Genre variable to Corpus
  3. Frequency Analysis: See which are the most used genres in a movie

```{r, echo=FALSE}
library(tm)
library(dplyr)
library(ggplot2)
library(wordcloud)
library(plyr)
genre <- Corpus(VectorSource(data$genres_2))
genre_dtm <- DocumentTermMatrix(genre)
genre_freq <- colSums(as.matrix(genre_dtm))
freq <- sort(colSums(as.matrix(genre_dtm)), decreasing=TRUE) 
genre_wf <- data.frame(word=names(genre_freq), freq=genre_freq)


ggplot(genre_wf, aes(x=reorder(word,-freq), y=freq))+ 
  geom_bar(stat="identity")+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ggtitle("Movie Genre frequency graph")+
  xlab("Genre")+
  ylab("Frequency") + 
  labs(alt = "Bar graph of Movie Genre frequency where drama is the most common")
```
---

```{r, echo = FALSE,warning = FALSE, fig.alt = "Word Cloud of movie genre frequency where Drama is the biggest"}

set.seed(10)
pal2 <- brewer.pal(8,"Dark2")
wordcloud(genre_wf$word,genre_wf$freq,random.order=FALSE,
          rot.per=.15, colors=pal2,scale=c(4,.9),
          title="WordCloud: Movie Genres") 
```

---

# Correlation Matrix
```{r, include=FALSE}
mydata <- data[, c(3,4,5,6,8,9,13,14,16,19,23,24,25,26,27)]
mydata <- na.omit(mydata) # DROP NaN value
cormat <- round(cor(mydata),2)
library(reshape2)
re_cormat <- melt(cormat)
```

```{r, echo=FALSE}
ggplot(data = re_cormat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile(color = "white") + 
  geom_text(aes(label = value), color = "white", size = 1) + # put the text values of each correlation
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + # rotate the x-label for easier reading
  coord_fixed() + # createline across each correlation
  labs(
    title = "Correlation Matrix of numerical variables",
    alt = "Heat Tile map of correlation in numerical values to show relationship between variables"
  )
```
---
# Visualizations
```{r, echo=FALSE, warning=FALSE}

ggplot(data, aes(x = content_rating, y = imdb_score)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(title = "IMDB Score by Content Rating",
       alt = "Box plots for each content rating type compared to IMDB score to show distribution")
```
---
# Visualizations

```{r, echo=FALSE, warning=FALSE}
ggplot(data, aes(x = imdb_score, y = director_facebook_likes)) +
  geom_point(stat = 'summary', fun = 'mean')  +
  labs(
    title = "IMDB Score VS median of the Director Facebook Likes",
    alt = "Scatterplot between the IMDB Score and the median of the Director Facebook Likes as it increases exponentially "
  )
```
---
# Visualizations

```{r, echo=FALSE, warning=FALSE}
 ggplot(data, aes(x = title_year, y = (gross / 100000), color = profit_flag)) +
   geom_point(alpha = .6) + 
   labs(
     y = "Gross($100,000)",
     title = "Scatter plot between the gross and the title_year",
     alt = "Scatter plot between the gross and the title_year showing if a movie is profitable"
   )

```
---

# Visualizations

```{r, echo=FALSE, warning=FALSE}
ggplot(data, aes(x = duration, y = imdb_score))+ 
  geom_point(aes(color = profit_flag))+ 
  geom_smooth(method="loess", se=F) + 
  labs(title="Duration Vs IMDB Score", 
       x="Duration", 
       y="IMDB Score",
       alt = "Scatterplot showing relationship between movie duration and IMDB score with trend line to see how the score changes")
```
---
class: inverse, middle, center

# Linear Regression

- Split the data into 70-30 training and test data
- Training data set - 3441
- Test data set - 31
- Built a model predicting IMDB Score based on Duration, Gross and Year

```{r, include=FALSE}
dt = sort(sample(nrow(data), nrow(data)*.7))
train<-data[dt,]
test<-data[-dt,]
dim(train)

```
``` {r, incude=FALSE}
lmModel <- lm(imdb_score ~ duration+gross+title_year, data = train)

# Printing the model object
print(lmModel)
```
---
```{r, echo=FALSE}
summary(lmModel)
```
---

# New Linear Model with both Numerical & Categorical Variables
- Previous Model lacked accuracy
- Added Profitability categorical variable
- Number of Voted Users and Number of Critics Reviews added
- Improved R-squared value
---
###### Summary of Model
```{r, include=FALSE}
new_lmModel <- lm(imdb_score ~ gross + budget  + title_year + num_voted_users+ num_critic_for_reviews + duration + profit_flag, data = train)
# Printing the model object
print(new_lmModel)
```
```{r, echo=FALSE}
summary(new_lmModel)
```

---
# Residual 
```{r, echo=FALSE}
ggplot(new_lmModel, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "IMDB Score", y = "Residuals")
```
---

# Predicted Results

```{r, echo=FALSE}
print('Test IMDB Scores:')
head(test$imdb_score)
print('IMDB Scores Predicted by Model:')
head(predict(new_lmModel, test))
```
---
class: middle, center
#Conclusions
- Model predicts IMDB Score based on number of voters, critic reviews, duration and more
- Not very accurate but predicted IMDB scores are close to actual values
- We need a more comprehensive data set to accurately predict IMDB Scores
- In the future:
  - Explore other datasets with more correlated variables
  - Predict other variables like Gross Revenue
  - Other types of regression models
Thank You!

---
class: inverse, middle, center
#QUESTIONS?

